---
import { themes } from "../conf.js";
import { themeStore } from "../state";
---

<div>
    <select id="theme-select" class="p-2 border border-light rounded">
        {
            themes.map((theme) => (
                <option value={theme} selected={themeStore.get() == theme}>
                    {theme}
                </option>
            ))
        }
    </select>
</div>

<script>
    import { themeStore } from "../state";

    function onThemeSwitch(event: any) {
        const selectedTheme = event.target.value;
        const currentTheme = themeStore.get();
        themeStore.set(selectedTheme);
        const t = document.getElementsByTagName("html")[0];
        console.log("Current theme", currentTheme);
        console.log("Switching to theme:", selectedTheme);
        t?.classList.remove("theme-" + currentTheme);
        t?.classList.add("theme-" + selectedTheme);
        localStorage.setItem("theme", selectedTheme);
        self.location.reload();
    }

    // Add event listener after DOM is loaded
    document.addEventListener("DOMContentLoaded", function () {
        const selectElement = document.getElementById("theme-select");
        if (selectElement) {
            selectElement.addEventListener("change", onThemeSwitch);
        }
    });
</script>
